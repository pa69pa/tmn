var tmn=function(t){var e={x:"&#xE5CD;",play:"&#xE037;",circle:'<svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" height="1em" width="1em" style="stroke:#ff0000;stroke-opacity:1;fill:#000080;fill-opacity:0.6;stroke-dasharray:none"><circle r="4.5" cy="5" cx="5" style="stroke-width:1;stroke-miterlimit:4" /></svg>',rectangle:'<svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" height="1em" width="1em" style="stroke:#ff0000;stroke-opacity:1;fill:#000080;fill-opacity:0.6;stroke-dasharray:none"><rect y="0" x="0" height="10" width="10" style="stroke-width:2;stroke-miterlimit:4" /></svg>',polygon:'<svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" height="1em" width="1em" style="stroke:#ff0000;stroke-opacity:1;fill:#000080;fill-opacity:0.6;stroke-dasharray:none"><path d="M 0,10 H 10 v -10 z" style="stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4" /></svg>',anyline:'<svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" height="1em" width="1em" style="stroke:#ff0000;stroke-opacity:1;fill:#000080;fill-opacity:0.6;stroke-dasharray:none"><path d="M 0,10 10,0" style="stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dashoffset:0" /></svg>',legend_select_color:"rgba(96, 152, 205, 0.9)"};"undefined"!=typeof setMNFontIcons&&setMNFontIcons(e);var n={zoomHiddenLegendIcon:12,zooLegIcon:[[13,3],[14,2]]},o=[];function a(e,n,i){null!=i&&(n=n[i]);var o=t('<div id="tmn-leg-'+n._leaflet_id+'">').data("mnScrollParent",this.legend.div.parent());o.appendTo(this.legend.div),n.on("layeradd",function(e){if(e.layer instanceof L.Marker)return;if(e.layer.options.legendItem){var n=t("#tmn-leg-"+e.target._leaflet_id,this.legend.div),i=[];t("span",n).each(function(){i.push(t(this).html())});var o=t.inArray(e.layer.options.legendItem,i);if(o<0){var a={};s(a,e.layer.options.legendItem,e.layer),l(a,n,e.target,this.map)}else{var c=t(t("label",n).get(o)),d=c.data("obj");d.push(e.layer),c.data("obj",d),r(e.layer,c,e.target)}}}.bind(this)),null!=e&&t("<h4>"+e+"</h4>").appendTo(o),t.inArray(""+n._leaflet_id,Object.keys(this.map._layers))<0?o.css("display","none"):this.legend.control.addTo(this.map),n.on("add",function(e){this.legend.control.addTo(this.map),t("#tmn-leg-"+e.target._leaflet_id,this.legend.div).show("fast",setMNScrollView)}.bind(this)),n.on("remove",function(e){t("#tmn-leg-"+e.target._leaflet_id,this.legend.div).hide(),0==t(".tmn-legend div:visible").length&&this.legend.control.remove()}.bind(this));var a={};t.each(n._layers,function(t,e){e.options.legendItem&&(null!=a[e.options.legendItem]?a[e.options.legendItem].obj.push(e):s(a,e.options.legendItem,e))}),l(a,o,n,this.map)}function s(n,i,o){n[i]={},n[i].obj=[],n[i].obj.push(o),n[i].ico=function(n){var i="";if(n._marker)i=t('<img src="'+n._marker.options.icon.options.iconUrl+'"/>');else{i=n instanceof L.Circle?t(e.circle):n instanceof L.Rectangle?t(e.rectangle):n instanceof L.Polygon?t(e.polygon):t(e.anyline);var o=n.options;null==o.color&&(o=n.options.style),o.color&&i.css("stroke",o.color),o.opacity&&i.css("stroke-opacity",o.opacity),o.fillColor&&i.css("fill",o.fillColor),o.fillOpacity&&i.css("fill-opacity",o.fillOpacity),o.dashArray&&i.css("stroke-dasharray",[3,2])}return i}(o)}function l(e,n,i,o){var a=0,s=!1;t.each(e,function(e,l){var c=t("<label> <span>"+e+"</span></label>").data("obj",l.obj).data("mnScrollParent",n.parent().parent()).on("cssanimationend animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){t(this).removeClass("tmn-shadow-pulse")}).on("click",function(){var e=t(this);a=setTimeout(function(){s||d.call(e,!0,o),s=!1},200)}).on("dblclick",function(){clearTimeout(a),s=!0,d.call(t(this),!1,o)}).prepend(l.ico).appendTo(n);t.each(l.obj,function(t,e){r(e,c,i)})})}function r(t,e,n){t.on("click",c)._leg=e,t._marker&&(t._marker._layerToAdd=n,t._marker.on("click",c))}function c(e){L.DomEvent.stopPropagation(e);var n=this,i=this._leg;null==i&&(n=this._master,i=this._master._leg),!function(e){var n=e._path;null==n&&t.each(e._layers,function(t,e){if(e._path)return n=e._path,!1});return t(n).hasClass("tmn-beacon")}(n)?i.addClass("tmn-shadow-pulse").scrollView():i.click()}function d(n,i){var o=!(this.css("background-color")==e.legend_select_color);o?(t(".tmn-legend label").filter(function(){return t(this).css("background-color")==e.legend_select_color}).click(),this.css("background-color",e.legend_select_color)):this.css("background-color","transparent");var a,s,l=null;n&&(s=i.getBounds()),t.each(this.data("obj"),function(e,n){o?(a=n.getBounds(),null==s?(s=a,l=a):s.contains(a)||(l=s.extend(a._northEast),l=s.extend(a._southWest)),h(n,!0)):h(n,!1),n._marker&&(o?t(n._marker._icon).addClass("tmn-beacon"):t(n._marker._icon).removeClass("tmn-beacon"))}),null!=l&&i.flyToBounds(l)}function h(e,n){var i=e._path;null==i&&t.each(e._layers,function(t,e){h(e,n)}),n?t(i).addClass("tmn-beacon"):t(i).removeClass("tmn-beacon")}function p(t){if(t.preventDefault&&t.preventDefault(),"function"==typeof t.data)t.data.call(this);else{var e;if(this.map.addLayer(t.data),t.data instanceof L.FeatureGroup)e=t.data.getBounds();else try{var n=L.featureGroup();t.data.eachLayer(function(t){n.addLayer(t)}),e=n.getBounds(),n=null}catch(t){console.log("Not possible create FeatureGroup â€” ",t)}null!=e&&this.map.flyToBounds(e)}}function m(){tmn.runBase=!1;var t=this.initArr.funcOnClose;switch(null!=t&&t(),this.initArr.anim){case"left":this.div.animate({left:"-"+this.div.width()+"px",opacity:0},1e3);break;case"right":this.div.animate({right:"-"+this.div.width()+"px",opacity:0},1e3);break;default:this.div.fadeOut()}}return L.Path.include({setMarker:function(t){if(this._marker=t,t._master=this,(null==this.options.zoomHidden||this.options.zoomHidden)&&o.push(t),this instanceof L.Polyline&&0==t._latlng.lat&&0==t._latlng.lng){var e=this.getBounds(),n=e._northEast.lat-(e._northEast.lat-e._southWest.lat)/2,i=e._northEast.lng-(e._northEast.lng-e._southWest.lng)/2;t.setLatLng([n,i])}return this}}),{id:"tmn root",runBase:!1,init:function(s,l){var r,c,d,h,u=!1;return null!=s&&s instanceof L.Map?(h=s,c=s.getContainer(),r=t(c)):(u=!0,r=t('<div id="tmn-base" />'),t("body").prepend(r),r.css("left","-"+r.width()+"px"),(c=t('<div style="width:100%;height:100vh" />')).appendTo(r),c=c[0],h=L.map(c,s)),r.addClass("tmn-base"),h.on("zoomend",function(){var e,i,a,s;h.getZoom()<n.zoomHiddenLegendIcon?t.each(o,function(t,e){e._layerToAdd&&e._layerToAdd.removeLayer(e)}):(t.each(n.zooLegIcon,function(t,e){if(h.getZoom()<e[0])return a=e[1],!1}),t.each(o,function(n,o){o._layerToAdd&&(o._layerToAdd.addLayer(o),s=t(o._icon),e=o.options.icon.options.iconSize,i=o.options.icon.options.iconAnchor,i=null!=a?{width:e[0]/a+"px",height:e[1]/a+"px","margin-left":"-"+i[0]/a+"px","margin-top":"-"+i[1]/a+"px"}:{width:e[0]+"px",height:e[1]+"px","margin-left":"-"+i[0]+"px","margin-top":"-"+i[1]+"px"},s.css(i))}))}),u&&(null==l&&(l={}),null==l.anim&&l.anim,"[X]"==l.close?(d=t('<div class="tmn-back x"><i class="mico">'+e.x+"</i></div>")).appendTo(r):null!=l.close&&(d=t(l.close))),r.tmn={div:r,container:c,map:h,control:null,legend:{},initArr:l,isBase:u,fiBase:!0,fiRunlay:!0,nav:function(n,i,o,a){return this.control=L.control.layers(n,i,a).addTo(this.map),null!=o&&t.each(o,function(n,i){var o=t("form",this.control.getContainer());this.fiRunlay&&(this.fiRunlay=!1,t('<div class="leaflet-control-layers-separator"></div>').appendTo(o)),t('<span class="tmn-run"><i class="mico">'+e.play+"</i>&nbsp;"+n+"</span>").click(i,p.bind(this)).appendTo(o)}.bind(this)),this},agrLegend:function(e,n={}){null==n.position&&(n.position="bottomright");var i=L.control(n),o=L.DomUtil.create("div","tmn-legend");return L.DomEvent.disableScrollPropagation(o),L.DomEvent.disableClickPropagation(o),L.DomEvent.on(o,"doubleclick",function(t){L.DomEvent.preventDefault(t)}),n.classAgrLegend&&L.DomUtil.addClass(o,n.classAgrLegend),this.legend.div=t("<div/>"),t(o).attr("onmousedown","return false").attr("onselectstart","return false").append(this.legend.div),i.onAdd=function(t){return t}.bind(this,o),this.legend.control=i,e instanceof L.FeatureGroup?a.call(this,null,e):t.isArray(e)?t.each(e,a.bind(this,null,e)):t.each(e,a.bind(this)),this},show:function(t){r.tmn.isBase&&(r.tmn.fiBase&&function(t){switch(t.tmn.fiBase=!1,t.tmn.initArr.anim){case"left":t.css({left:"-"+t.width()+"px",display:"block"});break;case"right":t.css({right:"-"+t.width()+"px",display:"block"});break;default:t.css({left:0,opacity:1})}}(r),function(t){tmn.runBase=!0;var e=this.tmn.initArr.funcBefore;null!=e&&e();var n=this.tmn.control._layers,o=t.layers.length;for(i=0;i<n.length;i++){for(j=0;j<o&&n[i].layer._leaflet_id!=t.layers[j]._leaflet_id;j++);j==o&&this.tmn.map.removeLayer(n[i].layer)}for(j=0;j<o;j++)this.tmn.map.addLayer(t.layers[j]);switch(this.tmn.initArr.anim){case"left":this.animate({left:"0px",opacity:1},1e3);break;case"right":this.animate({right:"0px",opacity:1},1e3);break;default:this.fadeIn()}null!=t.run&&this.tmn.map.whenReady(p.bind(this.tmn,{data:t.run}))}.call(r,t.data))}},null!=d&&d.click(m.bind(r.tmn)),"undefined"!=typeof getMNFontIcons&&getMNFontIcons(),t("head").append("<style>@keyframes tmnShadowPulse{ 20% {box-shadow: inset 0 0 7px 4px "+e.legend_select_color+"} 50% {box-shadow: 0px 0px 0px 0px hsla(0, 0%, 0%, 0)} 70% {box-shadow: inset 0 0 7px 4px "+e.legend_select_color+"}100% {box-shadow: 0px 0px 0px 0px hsla(0, 0%, 0%, 0)}}.tmn-shadow-pulse{animation-name: tmnShadowPulse;animation-duration: 1.4s;animation-iteration-count: 1;animation-timing-function: linear;}</style>"),r.tmn},close:m,icons:MNLoc.arr.bind(e),hits:MNLoc.arr.bind(n)}}(jQuery);
